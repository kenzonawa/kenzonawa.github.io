
<!DOCTYPE html>
<html>
<head>
	<title>ACS Data Visualization</title>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.6/d3.min.js" charset="utf-8"></script>
	<script type="text/javascript" src="https://d3js.org/d3-queue.v3.min.js"></script>
	<script src="https://d3js.org/d3.v4.js"></script><!-- added by divi -->
	<link rel="stylesheet" href="normalize.css"><!-- added by divi -->
	<script src="https://d3js.org/topojson.v1.min.js"></script><!-- added by swati -->
	<style type="text/css">
	
	/* On mouse hover, lighten state color */
	#main path:hover {
		fill-opacity: .6;
	}

	.rect:hover {
		fill-opacity: .8;
	}
	
	/* Style for Custom Tooltip */
	div.Populationtooltip {   
	 	position: absolute;           
		text-align: center;           
		width: 100px;                  
		height: 28px;                 
		padding: 2px;             
		font: 20px sans-serif;        
		background: white;   
		border: 0px;      
		border-radius: 8px;           
		pointer-events: none;         
	}
	div.tooltip {   
	 	position: absolute;           
		text-align: center;           
		width: 60px;                  
		height: 28px;                 
		padding: 2px;             
		font: 12px sans-serif;        
		background: white;   
		border: 0px;      
		border-radius: 8px;           
		pointer-events: none;         
	}
	        
	/* Legend Font Style */
	body {
		font: 11px sans-serif;
	}
	        
	/* Legend Position Style */
	.legend {
		position:absolute;
		left:800px;
		top:350px;
	}
	
	.arc text {
	  font: 10px sans-serif;
	  text-anchor: middle;
	}

	.arc path {
	  stroke: #fff;
	}

	.maps{
		float:left;
	}	
	
	.chart rect {
		fill: steelblue;
	}

	/* Divi Changes Begin here */
	.pie-area {
			height: 350px;
			margin: 20 auto auto auto;
			position: relative;
			width: 350px;
			
		}
		/*Transport PieChart ToolTipBox*/
		
		.pie-tooltip {
			position: absolute;
			width: 250px;
			height: 340px;
			padding-left: 40px;
			border-radius: 8px;
			background: white;
			border: 0px;
			
			pointer-events: none;
		}
		
		.Time-pie-tooltip {
			position: absolute;
			width: 350px;
			height: 420px;
			padding: 1px;
			background: white;
			border: 0px;
			padding-left: 20px;
			padding-left: 20px;
			border-radius: 8px;
			pointer-events: none;
		}
		
		#transportmap .tooltip {
			background: #eee;
			box-shadow: 0 0 5px #999999;
			color: #333;
			display: none;
			font-size: 12px;
			left: 130px;
			padding: 10px;
			position: absolute;
			text-align: center;
			top: 95px;
			width: 80px;
			z-index: 10;
		}
		
		#household {
			text-align: center;
		}
		/*TransPieChartAreaStyles*/
		
		.legend {
			font-size: 14px;
		}
		/*TransPieChartAreaStyles*/
		
		rect {
			cursor: pointer;
			stroke-width: 2;
		}
		/*TransPieChartAreaStyles */
		
		rect.disabled {
			fill: transparent !important;
		}
		/*TransPieChartAreaStyles */
		
		h1 {
			font-size: 10px;
			text-align: center;
		}
		
		h2 {
			font-size: 24px;
			text-align: center;
		}
		
		#xaxis .domain {
			fill: none;
			stroke: #000;
		}
		
		#xaxis text,
		#yaxis text {
			font-size: 12px;
		}
		
		#wrapper {
			position: relative;
			margin-top: 700px;
		}
		
		#single-chart {
			float: left;
			margin: 0 0 10px 10px;
		}
		
		.bar {
			fill: steelblue;
		}
	/*Divi Changes end here */

	</style>
</head>
<body>
	<a href="documentation.html"> Documentation </a>
	<a href="smallView.html"> Heat Map </a>
	<h2 style= "color:#373737;" align="center">2015 USA - People And LifeStyle</h2>
    <div id="choice">
    <text id="test" style="position: absolute; left: 50px; top: 80px"> Choose Your Option</text>
	<select id="variableSelection" style="position: absolute; left: 150px; top: 80px">
	  <option value="999">--Select--</option>
	  <option value="0">Population Distribution</option>
	  <option value="1">Sex Distribution</option>
	  <option value="2">Loneliness</option>
	  <option value="3">Transportation</option>
	  <option value="4">Daily Commute Time To Work</option>
	  <option value="5">Graduate Education</option>
	</select>
        <button id="StateButton" style="position: absolute; left: 325px; top: 80px">State</button>
		<button id="CountyButton" style="position: absolute; left: 370px; top: 80px">County</button>
</form>
    <text id="scatterAnalyse" style="position: absolute; left: 700px; top: 80px">variable one</text>
	<select id="scatterSelection1" style="position: absolute; left: 760px; top: 80px">
	  <option value="999">--Select--</option>
	  <option value="0">Population Distribution</option>
	  <option value="1">Sex Distribution</option>
	  <option value="7">Loneliness</option>
	  <option value="8">Foreign Born</option>
	</select>
    <text id="scatterAnalyse" style="position: absolute; left: 920px; top: 80px">variable two</text>
	<select id="scatterSelection2" style="position: absolute; left: 980px; top: 80px">
	  <option value="999">--Select--</option>
	  <option value="0">Population Distribution</option>
	  <option value="1">Sex Distribution</option>
	  <option value="7">Loneliness</option>
	  <option value="8">Foreign Born</option>
	</select>
	<button id="scatter" style="position: absolute; left: 1150px; top: 80px"> View </button>
	<button id="clearScatter" style="position: absolute; left: 1200px; top: 80px"> Clear </button>
	
    </div>
	<div id="map" style="position: relative; top: 100px" >
	<svg id="main" class='graph' width="1000" height="600" >
		<text id='label' style="position: absolute; left: 100px; top: 70px"></text>
	</svg>


	<svg id="fourth" class='graph' width="550" height="550" style="position:absolute; top: 50px; left: 1000px">
		<text id='label' style="float:right"></text>
	</svg>
	</div>

<!--<svg id="third" class='graph' width="450" height="500">
		<text id='label' style="position: relative;"></text>
	</svg>-->
	
	<div id="multi-wrapper" style="position: relative; top: 200px"></div>
	
	<script>
	
	var AllStatesData = [];
	var MapWidth = 1000;
	var MapHeight = 600;
	var PieChartWidth = 450;
	var PieChartHeight = 250;
	var BarChartWidth = 400;
	var BarChartHeight = 300;
	var Default = 999;
	var MaxVal;
	var MinVal;
	var MapScale = 1300;
	var DefaultColor = [];
	var TotalPopulation = 1;
	var SexDisMale = 2;
	var SexDistFemale = 3;
	var MedianAgeTot = 4;
	var MedianAgeMale = 5;
	var MedianAgeFemale = 6;
	var LiveAlone = 7;
	var LiveWithSpouse = 8;
	var LiveWithPartner = 9;
	var HavingChild = 10;
	var LiveOtherRelative = 11;
	var LiveNonRelative = 12;
	var TotByNat = 43;
	var ForeignBorn = 44;
	var TotalGraduate = 49;
	var GraduateInState = 50;
	var GraduateOutState = 51;
	var GraduateNative = 52;
	var GraduateForeign = 53;
	var lonely = [];
	var foreigners = [];
	var sexdist = [];
	
	var TransportData =[];
	var TimeToTravelData=[];
	var TransMaxVal;
	var TransMinVal;
	var pieChartLocationX = 1300;
	var pieChartLocationY = 300;

	var AllCountyData = [];
	var CountyData = d3.map();

	var myColors = 	[["rgb(231,225,239)","rgb(166,189,219)","rgb(28,144,153)"],//Total Population
					 ["rgb(247,104,161)","rgb(254,235,226)","rgb(241,238,246)","rgb(4,90,141)"], //Sex Distribution Male and Female
					 ["rgb(229,245,249)","rgb(44,162,95)"], // Loneliness
					 ["rgb(254,232,200)","rgb(253,187,132)","rgb(227,74,51)"], //Transportation	
					 ["rgb(254,224,210)","rgb(252,146,114)","rgb(222,45,38)"], // Daily Commute Time To Work 
					 ["rgb(154,224,210)","rgb(152,146,114)","rgb(122,45,38)"], //Graduate Education
					 ['rgb(165,0,38)','rgb(215,48,39)','rgb(244,109,67)','rgb(253,174,97)','rgb(254,224,144)','rgb(255,255,191)','rgb(224,243,248)','rgb(171,217,233)','rgb(116,173,209)','rgb(69,117,180)','rgb(49,54,149)'] // default
					];
					
					
	var myPieChartColors = [ ["rgb(254,235,226)","rgb(241,238,246)"],//Pie Chart Color for Sex Distribution
							 ["#98abc5", "#8a89a6", "#7b6888", "#6b486b", "#a05d56", "#d0743c", "#ff8c00"]// Pie Chart for Lonliness
						   ];
	var q2 = d3.queue()
	.defer(d3.json, "us.json")
	//Total Graduates
	.defer(d3.json, "https://api.census.gov/data/2015/acs1?get=NAME,B06009_006E&for=county:*&key=73e1331e8e24e6a2bb488ad78eb65aac8b0a96be")
	//Total Population
	.defer(d3.json, "https://api.census.gov/data/2015/acs1?get=NAME,B01003_001E&for=county:*&key=73e1331e8e24e6a2bb488ad78eb65aac8b0a96be")
	//Total Lonely People
	.defer(d3.json, "https://api.census.gov/data/2015/acs1?get=NAME,B09021_002E&for=county:*&key=73e1331e8e24e6a2bb488ad78eb65aac8b0a96be")
	//Total Graduates
	.defer(d3.json, "https://api.census.gov/data/2015/acs1?get=NAME,B06009_006E&for=county:*&key=73e1331e8e24e6a2bb488ad78eb65aac8b0a96be")
	//Total Transportation
	.defer(d3.json, "https://api.census.gov/data/2015/acs1?get=NAME,B08301_001E&for=county:*&key=73e1331e8e24e6a2bb488ad78eb65aac8b0a96be")
	.awaitAll(DisplayCounties);
	
	function DisplayCounties(error, CountyResults)
	{
		if (error) throw error;
		
		 AllCountyData[0] = CountyResults[0];// us-county json
		 AllCountyData[1] = CountyResults[1];//Graduates
		 AllCountyData[2] = CountyResults[2];//Population
		 AllCountyData[3] = CountyResults[3];//Lonely People
		 AllCountyData[4] = CountyResults[4];//Graduates
		 AllCountyData[5] = CountyResults[5];//Transportation
		 
	}	

	var q = d3.queue()
    //0. States
	.defer(d3.json, "us-states.json")
	//1. Total Population
    .defer(d3.json, "https://api.census.gov/data/2015/acs1?get=NAME,B01003_001E&for=state:*&key=73e1331e8e24e6a2bb488ad78eb65aac8b0a96be")
    //2. Sex Distribution-Male
    .defer(d3.json, "https://api.census.gov/data/2015/acs1?get=NAME,B01001_002E&for=state:*&key=73e1331e8e24e6a2bb488ad78eb65aac8b0a96be")
    //3. Sex Distribution-Female
	.defer(d3.json, "https://api.census.gov/data/2015/acs1?get=NAME,B01001_026E&for=state:*&key=73e1331e8e24e6a2bb488ad78eb65aac8b0a96be")
	//4. Median Age-Total
	.defer(d3.json, "https://api.census.gov/data/2015/acs1?get=NAME,B01002_001E&for=state:*&key=73e1331e8e24e6a2bb488ad78eb65aac8b0a96be")
	//5. Median Age-Male
	.defer(d3.json, "https://api.census.gov/data/2015/acs1?get=NAME,B01002_002E&for=state:*&key=73e1331e8e24e6a2bb488ad78eb65aac8b0a96be")
	//6. Median Age- Female
	.defer(d3.json, "https://api.census.gov/data/2015/acs1?get=NAME,B01002_003E&for=state:*&key=73e1331e8e24e6a2bb488ad78eb65aac8b0a96be")
	//7. Lives Alone
	.defer(d3.json, "https://api.census.gov/data/2015/acs1?get=NAME,B09021_002E&for=state:*&key=73e1331e8e24e6a2bb488ad78eb65aac8b0a96be")
	//8.  Householder Living With Spouse or vice-versa
	.defer(d3.json, "https://api.census.gov/data/2015/acs1?get=NAME,B09021_003E&for=state:*&key=73e1331e8e24e6a2bb488ad78eb65aac8b0a96be")
	//9. Householder Living With Unmarried Partner or vice-versa
	.defer(d3.json, "https://api.census.gov/data/2015/acs1?get=NAME,B09021_004E&for=state:*&key=73e1331e8e24e6a2bb488ad78eb65aac8b0a96be")
	//10. Child of Householder
	.defer(d3.json, "https://api.census.gov/data/2015/acs1?get=NAME,B09021_005E&for=state:*&key=73e1331e8e24e6a2bb488ad78eb65aac8b0a96be")
	//11. Other Relatives
	.defer(d3.json, "https://api.census.gov/data/2015/acs1?get=NAME,B09021_006E&for=state:*&key=73e1331e8e24e6a2bb488ad78eb65aac8b0a96be")
	//12. Other Nonrelatives
	.defer(d3.json, "https://api.census.gov/data/2015/acs1?get=NAME,B09021_007E&for=state:*&key=73e1331e8e24e6a2bb488ad78eb65aac8b0a96be")
	//13. Transport
	.defer(d3.json, "https://api.census.gov/data/2015/acs1?get=NAME,B08301_001E&for=state:*&key=73e1331e8e24e6a2bb488ad78eb65aac8b0a96be")
    //14. driving car alone
    .defer(d3.json, "https://api.census.gov/data/2015/acs1?get=NAME,B08301_003E&for=state:*&key=73e1331e8e24e6a2bb488ad78eb65aac8b0a96be")
    //15. Carpool
    .defer(d3.json, "https://api.census.gov/data/2015/acs1?get=NAME,B08301_004E&for=state:*&key=73e1331e8e24e6a2bb488ad78eb65aac8b0a96be")
    //16. TransportPublic
	.defer(d3.json, "https://api.census.gov/data/2015/acs1?get=NAME,B08301_010E&for=state:*&key=73e1331e8e24e6a2bb488ad78eb65aac8b0a96be")
    //17. TransportTaxiCab
	.defer(d3.json, "https://api.census.gov/data/2015/acs1?get=NAME,B08301_016E&for=state:*&key=73e1331e8e24e6a2bb488ad78eb65aac8b0a96be")
    //18. TransportMotorCycle
	.defer(d3.json, "https://api.census.gov/data/2015/acs1?get=NAME,B08301_017E&for=state:*&key=73e1331e8e24e6a2bb488ad78eb65aac8b0a96be")
    //19. TransportBicycle
    .defer(d3.json, "https://api.census.gov/data/2015/acs1?get=NAME,B08301_018E&for=state:*&key=73e1331e8e24e6a2bb488ad78eb65aac8b0a96be")
    //20. TransportWalked
	.defer(d3.json, "https://api.census.gov/data/2015/acs1?get=NAME,B08301_019E&for=state:*&key=73e1331e8e24e6a2bb488ad78eb65aac8b0a96be")
    //21. TransportOtherMeans
	.defer(d3.json, "https://api.census.gov/data/2015/acs1?get=NAME,B08301_020E&for=state:*&key=73e1331e8e24e6a2bb488ad78eb65aac8b0a96be")
    //22. TransportWorkedAtHome
    .defer(d3.json, "https://api.census.gov/data/2015/acs1?get=NAME,B08301_021E&for=state:*&key=73e1331e8e24e6a2bb488ad78eb65aac8b0a96be")
	//23. Median Household income
	.defer(d3.json, "https://api.census.gov/data/2015/acs1?get=NAME,B19013_001E&for=state:*&key=73e1331e8e24e6a2bb488ad78eb65aac8b0a96be")
	 //24. carpool 2
    .defer(d3.json, "https://api.census.gov/data/2015/acs1?get=NAME,B08301_005E&for=state:*&key=73e1331e8e24e6a2bb488ad78eb65aac8b0a96be")
    //25. carpool 3
	.defer(d3.json, "https://api.census.gov/data/2015/acs1?get=NAME,B08301_006E&for=state:*&key=73e1331e8e24e6a2bb488ad78eb65aac8b0a96be")
    //26. carpool 4
	.defer(d3.json, "https://api.census.gov/data/2015/acs1?get=NAME,B08301_007E&for=state:*&key=73e1331e8e24e6a2bb488ad78eb65aac8b0a96be")
    //27. carpool 5 and 6
    .defer(d3.json, "https://api.census.gov/data/2015/acs1?get=NAME,B08301_008E&for=state:*&key=73e1331e8e24e6a2bb488ad78eb65aac8b0a96be")
	//28. carpool 7
	.defer(d3.json, "https://api.census.gov/data/2015/acs1?get=NAME,B08301_009E&for=state:*&key=73e1331e8e24e6a2bb488ad78eb65aac8b0a96be")
	 //29. to travel Total
	.defer(d3.json, "https://api.census.gov/data/2015/acs1?get=NAME,B08303_001E&for=state:*&key=73e1331e8e24e6a2bb488ad78eb65aac8b0a96be")
    //30. to travel Less than 5 minutes 
    .defer(d3.json, "https://api.census.gov/data/2015/acs1?get=NAME,B08303_002E&for=state:*&key=73e1331e8e24e6a2bb488ad78eb65aac8b0a96be")
    //31. to travel 5 to 9 Minutes
    .defer(d3.json, "https://api.census.gov/data/2015/acs1?get=NAME,B08303_003E&for=state:*&key=73e1331e8e24e6a2bb488ad78eb65aac8b0a96be")
    //32. to travel 10 to 14 Minutes
    .defer(d3.json, "https://api.census.gov/data/2015/acs1?get=NAME,B08303_004E&for=state:*&key=73e1331e8e24e6a2bb488ad78eb65aac8b0a96be")
    //33. to travel 15 to 19 Minutes
	.defer(d3.json, "https://api.census.gov/data/2015/acs1?get=NAME,B08303_005E&for=state:*&key=73e1331e8e24e6a2bb488ad78eb65aac8b0a96be")
    //34. to travel 20 to 24 Minutes
	.defer(d3.json, "https://api.census.gov/data/2015/acs1?get=NAME,B08303_006E&for=state:*&key=73e1331e8e24e6a2bb488ad78eb65aac8b0a96be")
    //35. to travel 25 to 29 Minutes
	.defer(d3.json, "https://api.census.gov/data/2015/acs1?get=NAME,B08303_007E&for=state:*&key=73e1331e8e24e6a2bb488ad78eb65aac8b0a96be")
    //36. to travel 30 to 34 Minutes
    .defer(d3.json, "https://api.census.gov/data/2015/acs1?get=NAME,B08303_008E&for=state:*&key=73e1331e8e24e6a2bb488ad78eb65aac8b0a96be")
    //37. to travel 35 to 39 Minutes
	.defer(d3.json, "https://api.census.gov/data/2015/acs1?get=NAME,B08303_009E&for=state:*&key=73e1331e8e24e6a2bb488ad78eb65aac8b0a96be")
    //38. to travel 40 to 44 Minutes
	.defer(d3.json, "https://api.census.gov/data/2015/acs1?get=NAME,B08303_010E&for=state:*&key=73e1331e8e24e6a2bb488ad78eb65aac8b0a96be")
    //39. to travel 45 to 59 Minutes
    .defer(d3.json, "https://api.census.gov/data/2015/acs1?get=NAME,B08303_011E&for=state:*&key=73e1331e8e24e6a2bb488ad78eb65aac8b0a96be")
	//40. to travel 60 to 89 Minutes
	.defer(d3.json, "https://api.census.gov/data/2015/acs1?get=NAME,B08303_012E&for=state:*&key=73e1331e8e24e6a2bb488ad78eb65aac8b0a96be")
    //41. to travel 90 or More Minutes
    .defer(d3.json, "https://api.census.gov/data/2015/acs1?get=NAME,B08303_013E&for=state:*&key=73e1331e8e24e6a2bb488ad78eb65aac8b0a96be")
	//42. Per Capita Income
	.defer(d3.json, "https://api.census.gov/data/2015/acs1?get=NAME,B19301_001E&for=state:*&key=73e1331e8e24e6a2bb488ad78eb65aac8b0a96be")
	//43. Total Population by Place of Nativity
	.defer(d3.json, "https://api.census.gov/data/2015/acs1?get=NAME,C05002_001E&for=state:*&key=73e1331e8e24e6a2bb488ad78eb65aac8b0a96be")
	//44. Foreign Born
	.defer(d3.json, "https://api.census.gov/data/2015/acs1?get=NAME,C05002_008E&for=state:*&key=73e1331e8e24e6a2bb488ad78eb65aac8b0a96be")
	//45. 18 - 34 Years
	.defer(d3.json, "https://api.census.gov/data/2015/acs1?get=NAME,B09021_008E&for=state:*&key=73e1331e8e24e6a2bb488ad78eb65aac8b0a96be")
	//46. 18-34 Lives Alone
	.defer(d3.json, "https://api.census.gov/data/2015/acs1?get=NAME,B09021_009E&for=state:*&key=73e1331e8e24e6a2bb488ad78eb65aac8b0a96be")
	//47. 35 - 64 Years
	.defer(d3.json, "https://api.census.gov/data/2015/acs1?get=NAME,B09021_015E&for=state:*&key=73e1331e8e24e6a2bb488ad78eb65aac8b0a96be")
	//48. 35-64 Lives Alone
	.defer(d3.json, "https://api.census.gov/data/2015/acs1?get=NAME,B09021_016E&for=state:*&key=73e1331e8e24e6a2bb488ad78eb65aac8b0a96be")
	//47. 65+ Years
	.defer(d3.json, "https://api.census.gov/data/2015/acs1?get=NAME,B09021_022E&for=state:*&key=73e1331e8e24e6a2bb488ad78eb65aac8b0a96be")
	//48. 65+ Lives Alone
	.defer(d3.json, "https://api.census.gov/data/2015/acs1?get=NAME,B09021_023E&for=state:*&key=73e1331e8e24e6a2bb488ad78eb65aac8b0a96be")
	//49 Total Graduates
	.defer(d3.json, "https://api.census.gov/data/2015/acs1?get=NAME,B06009_006E&for=state:*&key=73e1331e8e24e6a2bb488ad78eb65aac8b0a96be")
	//50 Graduates Born in State of Residence
	.defer(d3.json, "https://api.census.gov/data/2015/acs1?get=NAME,B06009_012E&for=state:*&key=73e1331e8e24e6a2bb488ad78eb65aac8b0a96be")
	//51 Graduates Born in Other States
	.defer(d3.json, "https://api.census.gov/data/2015/acs1?get=NAME,B06009_018E&for=state:*&key=73e1331e8e24e6a2bb488ad78eb65aac8b0a96be")
	//52 Graduates Native, Born Outside of US
	.defer(d3.json, "https://api.census.gov/data/2015/acs1?get=NAME,B06009_024E&for=state:*&key=73e1331e8e24e6a2bb488ad78eb65aac8b0a96be")
	//53 Graduates Foreign Born
	.defer(d3.json, "https://api.census.gov/data/2015/acs1?get=NAME,B06009_030E&for=state:*&key=73e1331e8e24e6a2bb488ad78eb65aac8b0a96be")
	
	.awaitAll(function(error, Results) {
		  if (error) throw error;
	  
	  	  lonely.push(Results[LiveAlone].slice(1));
		  lonely.push(Results[LiveWithSpouse].slice(1));
		  lonely.push(Results[LiveWithPartner].slice(1));
		  lonely.push(Results[HavingChild].slice(1));
		  lonely.push(Results[LiveOtherRelative].slice(1));
		  lonely.push(Results[LiveNonRelative].slice(1)); 

		  foreigners.push(Results[TotByNat].slice(1));
	 	  foreigners.push(Results[ForeignBorn].slice(1));
	 	  console.log(foreigners);

	 	  sexdist.push(Results[SexDisMale].slice(1));
	 	  sexdist.push(Results[SexDistFemale].slice(1));

		  AllStatesData[0] = Results[TotalPopulation].slice(1);//TotalPopulation
		  AllStatesData[1] = Results[SexDisMale].slice(1);//Sex Distribution Male
		  AllStatesData[2] = Results[SexDistFemale].slice(1);//Sex Distribution Female
		  AllStatesData[3] = Results[MedianAgeTot].slice(1);//Median Age Total
		  AllStatesData[4] = Results[MedianAgeMale].slice(1);//Median Age Male
		  AllStatesData[5] = Results[MedianAgeFemale].slice(1);//Median Age Female
		  AllStatesData[6] = Results[13].slice(1);

		  AllStatesData[7] = getLonely(lonely);
		  AllStatesData[8] = getForeign(Results[0]);
		  AllStatesData[9] = getLittleLonely(Results[45].slice(1),Results[46].slice(1));
		  AllStatesData[10] = Results[TotalGraduate];//Born Total
		  AllStatesData[11] = Results[GraduateInState];//Born in State of Residence
		  AllStatesData[12] = Results[GraduateOutState];//Born in Out State of Residence
		  AllStatesData[13] = Results[GraduateNative];//Native Born in Other State of Residence
		  AllStatesData[14] = Results[GraduateForeign];//Foreign Born in State of Residence
		 
		//Data to use inside Transportation function  
		TransportData[0]=Results[13];//Total
		TransportData[1]=Results[14];//drive alone (cars)
		TransportData[2]=Results[15];//Carpool
		TransportData[3]=Results[16];//Public
		TransportData[4]=Results[17];//TaxiCab
		TransportData[5]=Results[18];//MotorCycle
		TransportData[6]=Results[19];//Bicycle
		TransportData[7]=Results[20];//Walked
		TransportData[8]=Results[21];//OtherMeansOfTransport
		TransportData[9]=Results[22];//WorkedFromHome
		TransportData[10]=Results[23];//Median house hold income
		TransportData[11]=Results[24];//carpool 2
		TransportData[12]=Results[25];//carpool 3
		TransportData[13]=Results[26];//carpool 4
		TransportData[14]=Results[27];//carpool 5 o 6
		TransportData[15]=Results[28];//carpool 7
		 
		 //Data to use inside TimeToTravel function
		 TimeToTravelData[0]=Results[29]; //total travel 
		 TimeToTravelData[1]=Results[30]; // less than 5
		 TimeToTravelData[2]=Results[31]; // 5 to 9
		 TimeToTravelData[3]=Results[32]; // 10 to 14
		 TimeToTravelData[4]=Results[33]; // 15 to 19 
		 TimeToTravelData[5]=Results[34]; // 20 - 24
		 TimeToTravelData[6]=Results[35]; // 25 - 29 
		 TimeToTravelData[7]=Results[36];// 30 -34 
		 TimeToTravelData[8]=Results[37]; //  35 - 39
		 TimeToTravelData[9]=Results[38]; // 40 - 44
		 TimeToTravelData[10]=Results[39]; // 45 - 59
		 TimeToTravelData[11]=Results[40]; // 60 - 89 
		 TimeToTravelData[12]=Results[41]; // 90 and above 

		 
		
		
		 ExtractData(Results[0],Default); //default
		 console.log(MaxVal);
		 drawMap(Results[0],6); //default
		 
		//ExtractDataSexDistribution(Results[0],1);//test
		//drawMap(Results[0],0);//test
		//drawBarChartSexDistribution(0);
		
		//scatterThePlot(AllStatesData[7],AllStatesData[9]);

		//getLonely(Results[0]);
		//drawMap(Results[0],2);
		 
			d3.select("#variableSelection")
				.on('change', function() {
					clearLegendHeadingBarcharts();
					d3.select("#main").selectAll('g').remove();
					d3.select("#main").selectAll('svg').remove();
					var e = document.getElementById("variableSelection").value;
					switch(e){
						case '0':  d3.select("#StateButton")
									.on('click', function() {
									clearLegendHeadingBarcharts();
									d3.select("#main").selectAll('g').remove();	
									d3.select("#main").selectAll('svg').remove();									
									ExtractData(Results[0],e); 
									drawMap(Results[0],e);
									});
								  d3.select("#CountyButton")
									.on('click', function() {
									clearLegendHeadingBarcharts();
								 d3.select("#main").selectAll('g').remove();
								 d3.select("#main").selectAll('svg').remove();									
									 ExtactDataCounty(AllCountyData[0],1);
								     drawMapCounty(AllCountyData[0],e)
									});								  
								 
								  break;
					    case '1': 
									d3.select("#StateButton")
									.on('click', function() {
									clearLegendHeadingBarcharts();
									d3.select("#main").selectAll('g').remove();	
									d3.select("#main").selectAll('svg').remove();									
									ExtractDataSexDistribution(Results[0],e);
								    drawMap(Results[0],e);
									});
									
									d3.select("#CountyButton")
									.on('click', function() {

									});
					              break;
					    case '2': 
								 d3.select("#StateButton")
									.on('click', function() {
									clearLegendHeadingBarcharts();
									d3.select("#main").selectAll('g').remove();	
									d3.select("#main").selectAll('svg').remove();									
									getLonely(lonely);
									ExtractData(Results[0],7); 
									drawMap(Results[0],e);
									});
								  d3.select("#CountyButton")
									.on('click', function() {
									clearLegendHeadingBarcharts();
									 d3.select("#main").selectAll('g').remove();
									 d3.select("#main").selectAll('svg').remove();
									 ExtactDataCounty(AllCountyData[0],3);
								     drawMapCounty(AllCountyData[0],e)
									});

					              break;
					    case '3':
									 d3.select("#StateButton")
									.on('click', function() {
									clearLegendHeadingBarcharts();
									d3.select("#main").selectAll('g').remove();	
									d3.select("#main").selectAll('svg').remove();									
									
									ExtactTransportData(Results[0],TransportData);
									drawTransportMap(Results[0],e);
									});
								   d3.select("#CountyButton")
									.on('click', function() {
									clearLegendHeadingBarcharts();
									 d3.select("#main").selectAll('g').remove();
									 d3.select("#main").selectAll('svg').remove();
									 ExtactDataCounty(AllCountyData[0],5);
								     drawMapCounty(AllCountyData[0],e)
									});

								  break;
						case '4':
								  d3.select("#main").selectAll('svg').remove();
								  ExtractTimeToTravelData(Results[0],TimeToTravelData); 
								 drawTimeToTravelMap(Results[0],e);
								break;
						case '5':
								  d3.select("#StateButton")
									.on('click', function() {
									clearLegendHeadingBarcharts();
									d3.select("#main").selectAll('g').remove();	
									d3.select("#main").selectAll('svg').remove();									
								
									 ExtactGraduateEducation(Results[0],10);
									 drawGraduateEducation(Results[0],e)
									});
								   d3.select("#CountyButton")
									.on('click', function() {
									clearLegendHeadingBarcharts();
									 d3.select("#main").selectAll('g').remove();
									 d3.select("#main").selectAll('svg').remove();
									 ExtactDataCounty(AllCountyData[0],4);
								     drawMapCounty(AllCountyData[0],e)
									});
								break;
					    default: clearLegendHeadingBarcharts();
								d3.select("#main").selectAll('g').remove();
								d3.select("#main").selectAll('svg').remove();
					            break;
					}		
				});

			d3.select('#scatter').on('click',function(){
				var file1 = document.getElementById("scatterSelection1");
				var selected1 = file1.options[file1.selectedIndex].value;
				var file2 = document.getElementById("scatterSelection2");
				var selected2 = file2.options[file2.selectedIndex].value;

				d3.select("#fourth").selectAll('g').remove();
				scatterThePlot(AllStatesData[selected1],AllStatesData[selected2]);
			});	

			d3.select('#clearScatter').on('click',function(){
				d3.select("#fourth").selectAll('g').remove();
			});		
	});
	function ExtactGraduateEducation(json,variable)
    {
        MinVal = 0;
    	MaxVal = 0;
        
		var DataValueArray = [];
		var GradVar = parseInt(variable);
		
		 for (var i = 1; i < AllStatesData[variable].length; i++){
            
			var DataValueT = AllStatesData[variable][i][1];
			var DataValueR = AllStatesData[GradVar+1][i][1];
			var DataValueO = AllStatesData[GradVar+2][i][1];
			var DataValueN = AllStatesData[GradVar+3][i][1];
			var DataValueF = AllStatesData[GradVar+4][i][1];
			var dataState = AllStatesData[variable][i][0];
			
			DataValueArray.push(parseFloat(DataValueT));
						
			for(var j=0;j<json.features.length;j++)
			{
				var jsonState = json.features[j].properties.name;
				if (dataState == jsonState) {
					
					json.features[j].properties.TotalGraduateData = parseFloat(DataValueT);
					json.features[j].properties.BornInStateOfR=parseFloat(DataValueR);
					json.features[j].properties.BornOutOfState=parseFloat(DataValueO);
					json.features[j].properties.BornOutNative=parseFloat(DataValueN);
					json.features[j].properties.BornForeign=parseFloat(DataValueF);
					
					break;
					
				}				
			}
		}
		
        MinVal = d3.min(DataValueArray);

    	MaxVal = d3.max(DataValueArray);

	}
	function drawGraduateEducation(json,colorVar)
	{

		//https://bl.ocks.org/michellechandra/0b2ce4923dc9b5809922
		//Width and height of map
		var width = MapWidth;//960;
		var height = MapHeight;//500;
		// D3 Projection

		var projection = d3.geo.albersUsa()
						   .translate([width/2, height/2])    // translate to center of screen
						   .scale([MapScale]);          // scale things down so see entire US

		// Define path generator

		var path = d3.geo.path()               // path generator that will convert GeoJSON to SVG paths
				  	 .projection(projection);  // tell path generator to use albersUsa projection
		// Define linear scale for output

		var color = d3.scale.linear()
					  .range(myColors[colorVar]);

		color.domain([MinVal, MaxVal]); // setting the range of the input data

		//Create SVG element and append map to the SVG

		var svg = d3.select("#main")
					.append("svg")
					.attr("id", "educationmap")
					.attr("width", width + 400)
					.attr("height", height);

		// Append Div for tooltip to SVG

		var EducationDiv = d3.select("body")
					.append("div")   
					.attr("class", "pie-tooltip")               
					.style("opacity", 0);

		// Bind the data to the SVG and create one path per GeoJSON feature

		svg.selectAll("path")
			.data(json.features)
			.enter()
			.append("path")
			.attr("d", path)
			.attr("class", "states")
			.style("stroke", "#fff")
			.style("stroke-width", "1")
			.style("fill", function(d) {
			// Get data value
			var value = d.properties.TotalGraduateData;
				if (value) {
				//If value exists…
					return color(value);
				} else {
				//If value is undefined…
					return "rgb(213,222,217)";
				}
			})
			.on('mouseover', function(d,i) {
				drawHoverPieChartEdu(EducationDiv,d);
            })			
			.on('mouseout', function(d) {		
							EducationDiv.transition()		
								.duration(500)		
								.style("opacity", 0);
                            d3.selectAll(".pie-area").remove();
							d3.selectAll("#pie-heading").remove();
							d3.selectAll("#household").remove();

			});

	}
	function drawHoverPieChartEdu(EducationDiv,d)
	{
		//starts here
		var width = 250;
		var height = 250;
		var radius = Math.min(width, height) / 2;
		var donutWidth = 25;
		var legendRectSize = 10;
		var legendSpacing = 10;
		var PieChartData = [];
		
		PieChartData[0] = d.properties.BornInStateOfR;
		PieChartData[1] = d.properties.BornOutOfState;
		PieChartData[2] = d.properties.BornOutNative;
		PieChartData[3] = d.properties.BornForeign;
		
		LegendData = ["Born In-State","Born Out-of-State","Native","Foreign"];
		
			
		var color = d3.scaleOrdinal(d3.schemeCategory10);
		var arc = d3.arc()
					.innerRadius(radius - donutWidth)
					.outerRadius(radius);
		var pie = d3.pie()
			.value(function(d) { return parseInt(d); })
			.sort(null);
			

			var tots = d.properties.TotalGraduateData;

			EducationDiv.append("h1")
				.attr("id","pie-heading")
				.style("font-size", "24px")
				.html(d.properties.name);
			EducationDiv.append("h2")
				.attr("id","household")
				.html("Total: " + tots);

			EducationDiv.append('svg')
				.attr("class", "pie-area")
				.attr('width', width)
				.attr('height', height)
				.append('g')
				.attr('transform', 'translate(' + (width/2 ) +
						',' + (height/2) + ')')
				.selectAll('path')
				.data(pie(PieChartData))
				.enter()
				.append('path')
				.attr('d', arc)
				.attr('fill', function(d, i) {
					return color(i);})

			EducationDiv.transition()		
				.duration(200)		
				.style("opacity", .9)		
				.style("left", (pieChartLocationX) + "px")		
				.style("top", (pieChartLocationY) + "px");

			var chart = d3.selectAll('.pie-area');
			var legend = chart.selectAll('.legend')
				.data(color.domain())
				.enter()
				.append('g')
				.attr('class', 'legend')
				.attr('transform', function(d, i) {
				var height = legendRectSize + legendSpacing;
				var offset =  height * color.domain().length / 2;
				var horz = 8 * legendRectSize;
				var vert = i * height + 50;
				return 'translate(' + horz + ',' + vert + ')';
				});

			legend.append('rect')
				.attr('width', legendRectSize)
				.attr('height', legendRectSize)
				.style('fill', color)
				.style('stroke', color)                                   // UPDATED (removed semicolon)                                                      // NEW
			legend.append('text')
				.attr('x', legendRectSize + legendSpacing)
				.attr('y', legendRectSize - legendSpacing + 5)
				.text(function(d,i) { return LegendData[i]; });
					
	}
	function ExtactData(json, variable)
    {
    	MinVal = 0;
    	MaxVal = 0;
		
		var DataValueArray=[];
		
		if(variable==Default)
		{
			for (var j = 0; j < json.features.length; j++)  {

				// Copy the data value into the JSON
				json.features[j].properties.dataValue = 100; 
			}
				
			MinVal=0;
			MaxVal=255;
		}
		else
		{
			for (var i = 1; i < AllStatesData[variable].length; i++) {

				// Grab State Name
				var dataState = AllStatesData[variable][i][0];

				// Grab data value 
				var dataValue = AllStatesData[variable][i][1];
				DataValueArray.push(parseFloat(dataValue)); 

				// Find the corresponding state inside the GeoJSON
				for (var j = 0; j < json.features.length; j++)  {
					var jsonState = json.features[j].properties.name;

					if (dataState == jsonState) {

					// Copy the data value into the JSON
					json.features[j].properties.dataValue = dataValue; 

					// Stop looking through the JSON
					break;
					}
				}
			}
		}
		
		MinVal=d3.min(DataValueArray);
		MaxVal=d3.max(DataValueArray);
	}
	function ExtactDataCounty(json, variable)
    {
    	MinVal = 0;
    	MaxVal = 0;
		
		var DataValueArray=[];
		
		console.log("i am here");
		//console.log(AllCountyData[variable]);
		
		for (var i = 1; i < AllCountyData[variable].length; i++) {

			// Grab State Name
			var dataCounty = AllCountyData[variable][i][2] + AllCountyData[variable][i][3];
			//console.log(parseInt(dataCounty));
			
			// Grab data value 
			var dataValue = AllCountyData[variable][i][1];
			DataValueArray.push(parseFloat(dataValue)); 

			CountyData.set(parseInt(dataCounty),parseFloat(dataValue));
								
		}
		//console.log(CountyData.id[0]);	
		MinVal=d3.min(DataValueArray);
		MaxVal=d3.max(DataValueArray);
		//console.log(MinVal);
		//console.log(MaxVal);
	}
	function drawMapCounty(json,colorVar)
	{
		//https://bl.ocks.org/michellechandra/0b2ce4923dc9b5809922
		//Width and height of map
		var width = MapWidth;//1500;//960;
		var height = MapHeight;//800;//500;

		// D3 Projection
		var projection = d3.geo.albersUsa()
						   .translate([width/2, height/2])    // translate to center of screen
						   .scale([MapScale]);          // scale things down so see entire US
		        
		// Define path generator
		var path = d3.geo.path()               // path generator that will convert GeoJSON to SVG paths
				  	 .projection(projection);  // tell path generator to use albersUsa projection

		// Define linear scale for output
		var color = d3.scale.linear().range(myColors[colorVar]);
		color.domain([MinVal, MaxVal]); // setting the range of the input data
		
		//Create SVG element and append map to the SVG
		var svg = d3.select("#main")
					.append("svg")
					.attr("width", width)
					.attr("height", height);
				
		// Append Div for tooltip to SVG
		var div = d3.select("body")
					.append("div")   
					.attr("class", "tooltip")               
					.style("opacity", 0);
					
		// Bind the data to the SVG and create one path per GeoJSON feature
		svg.append("g")
		.attr("class", "counties")
			.selectAll("path")
			.data(topojson.feature(json, json.objects.counties).features)
			.enter()
			.append("path")
			.attr("d", path)
			.style("stroke", "#fff")
			.style("stroke-width", "0.1")
			.style("fill", function(d) {

			// Get data value
			//var tempid = 
			var value = CountyData.get(d.id);
			//console.log(value);

				if (value) {
				//If value exists…
				return color(value);
				} else {
				//If value is undefined…
				return "rgb(213,222,217)";
				}
			});
		
		svg.append("path")
			.datum(topojson.feature(json, json.objects.states, function(a, b) { return a !== b; }))
			.attr("class", "states")
			.attr("d", path)
			.style("fill", "none")
			.style("stroke", "#fff")
			.style("stroke-linejoin", "round")
			.style("stroke-width", "1")			
			.on('mouseover', function(d,i){
							div.transition()		
								.duration(200)		
								.style("opacity", .9)		
						     //div.html(d.properties.name)	
							//div.html(d.properties.name+"</br>"+d.properties.dataValue)
								.style("left", (d3.event.pageX) + "px")		
								.style("top", (d3.event.pageY - 28) + "px");	
						})
			.on('mouseout', function(d) {		
							div.transition()		
								.duration(500)		
								.style("opacity", 0)
			});
	}
	function getLittleLonely(lonely1, lonely2)
	{
		console.log("Get Lonely");
		console.log(lonely1);
		var StatesData = [];
		var total = [];
		var DataValueArray = [];
		var temp = lonely1.slice();

			for(var i =0 ; i<lonely1.length ;i++)
			{
				var dataValue = ((lonely1[i][1]/lonely2[i][1])).toFixed(2);
			    DataValueArray.push(parseFloat(dataValue)); 
			}

			//console.log(DataValueArray);

			for(var i=0; i< lonely[0].length ; i++)
			{
				temp[i][1] = DataValueArray[i];
			}

	        return temp;
		
	}

	function getForeign(json)
	{
		//console.log("Get Foreign");
		//console.log(foreigners);
		var StatesData = [];
		var total = [];
		var DataValueArray = [];
		var temp = foreigners[0];

			for(var i =0 ; i<foreigners[0].length ;i++)
			{
				var dataValue = ((foreigners[1][i][1]/foreigners[0][i][1])*100).toFixed(2);
				DataValueArray.push(parseFloat(dataValue));
			}

			//var dataValue = ((d[0][1]/total[i])*100).toFixed(2);

			for(var i=0; i<json.features.length ; i++)
			{
				temp[i][1] = DataValueArray[i];
			}

	        return temp;
	}
	
	function scatterThePlot(variableX, variableY)
	{
			//console.log(selectedYear);
			//console.log(dataset[0]);
			//console.log("Scattering");
			//console.log(variableX);
			//console.log(variableY);
			var file1 = document.getElementById("scatterSelection1");
			var text1 = file1.options[file1.selectedIndex].text;
			var file2 = document.getElementById("scatterSelection2");
			var text2 = file2.options[file2.selectedIndex].text;
			var maxX = 0;
			var maxY = 0;
			var data = [];
			var originalColor;
			for(var i=0; i< variableX.length; i++)
			{
				data[i] = new Array();
				var x = parseInt(variableX[i][1]);
				var y = parseInt(variableY[i][1]);
				data[i].push(x);
				data[i].push(y);
				if (maxX == 0) 
				{
					maxX = x;
					maxY = y;
				}
				else 
				{
					if (maxX < variableX[i][1]) maxX = x;
					if (maxY < variableY[i][1]) maxY = y;
				}
			}
			var chartWidth = 400;
			var chartHeight = 400;
			var z = d3.scale.category10();

			var yScale = d3.scaleLinear()
				.domain([0,maxY])
				.range([chartHeight,0]);

			var xScale = d3.scaleLinear()
				.domain([0,maxX])
				.range([0,chartWidth]);

			var group = d3.select('#fourth').append("g")
				.attr("transform", "translate(100, 100)");

			var states = d3.selectAll(".states");
			states = states._groups;
			console.log("States");
			console.log(states);

			var div = d3.select("body").append("div")	
			    .attr("class", "tooltip")				
			    .style("opacity", 0);

			//https://bl.ocks.org/WilliamQLiu/bd12f73d0b79d70bfbae
			group.selectAll(".dot")
				      .data(data)
				      .enter().append("circle")
				      .attr("class", "dot")
				      .attr("r", function(d){
				      	return 5;
				      })
				      .attr("cx", function(d,i){
				      	return xScale(d[0]);
				      })
				      .attr("cy", function(d,i){
				      	return yScale(d[1]);
				      })
				      .style("fill", function(d,i) { return z(i); })
				      .on('mouseover', function(d,i){
				    	div.transition()		
			                .duration(200)		
			                .style("opacity", .9);		
			            div	.html(variableX[i][0])
			                .style("left", (d3.event.pageX) + "px")		
			                .style("top", (d3.event.pageY - 28) + "px");	

			           /* for(var j=0;j<states[0].length;j++)
			            {
			            	states[0][j].style.opacity = 0.2;
			            }*/
			            states[0][i].style.opacity = 1;
			            originalColor = states[0][i].style.fill;
			            states[0][i].style.fill = "orange"

				    })
      				.on('mouseout', function(d,i) {		
			            div.transition()		
			                .duration(500)		
			                .style("opacity", 0);	

			            for(var j=0;j<states[0].length;j++)
			            {
			            	states[0][j].style.opacity = 1;
			            }

			            states[0][i].style.fill = originalColor;
			        });

			var	xAxis = d3.axisBottom();
			
			xAxis.scale(xScale);

			group.append("g")
				.attr('class', 'axis')
				.attr('transform', 'translate(0,' + chartHeight + ')')
				.call(xAxis)

			group.append("text")
			    .attr("dy", ".71em")
		        .style("text-anchor", "middle")
		         .attr("transform",
           						 "translate(" + (BarChartWidth/2) + " ," + 
                         		  (BarChartHeight + 130) + ")")
		        .style("font-size", "12px")
	   	        .text(text1);

			var	yAxis = d3.axisLeft();
			yAxis.scale(yScale);

			group.append("g")
				.attr('class', 'axis')
				.attr('transform', 'translate(-2,0)')
				.call(yAxis)

			group.append("text")
			    .attr("transform", "rotate(-90)")
			    .attr("y", -40)
			    .attr("x", 0 - (BarChartHeight/2))
			    .attr("dy", ".71em")
		        .style("text-anchor", "middle")
		        .style("font-size", "12px")
	   	   	     .text(text2);

	}

	function getSexDistribution(lonely)
	{
		var StatesData = [];
		var total = [];
		var DataValueArray = [];
		var temp = [];

		for( var i =0 ; i < lonely[0].length ; i++)
		{
			temp[i] = lonely[0][i].slice();
		}

			for(var i =0 ; i<lonely.length ;i++)
			{
				for(var j =0; j < lonely[0].length ; j++)
				{
					if(StatesData[j] == undefined) 
					{
						total[j] = 0;
						StatesData[j] = new Array();
					}
					total[j] += parseFloat(lonely[i][j][1]);
					StatesData[j].push(lonely[i][j][1]);
				}
			}

	        StatesData.forEach(function(d,i) {
			    var dataValue = ((d[0]/total[i])*1000).toFixed(4);
			    DataValueArray.push(parseFloat(dataValue)); 
			   // console.log(dataValue);
			});
   
			for(var i=0; i< lonely[0].length ; i++)
			{
				temp[i][1] = DataValueArray[i];
			}

			console.log("sex");
			console.log(temp);

	        return temp;
		
	}

	function getLonely(lonely)
	{
		//console.log("Get Lonely");
		//console.log(lonely);
		var StatesData = [];
		var total = [];
		var DataValueArray = [];
		var temp = [];

		for( var i =0 ; i < lonely[0].length ; i++)
		{
			/*temp[i] = new Array();
			temp[i].push(lonely[0][i].slice());*/
			temp[i] = lonely[0][i].slice();
		}

			for(var i =0 ; i<lonely.length ;i++)
			{
				for(var j =0; j < lonely[0].length ; j++)
				{
					if(StatesData[j] == undefined) 
					{
						total[j] = 0;
						StatesData[j] = new Array();
					}
					total[j] += parseFloat(lonely[i][j][1]);
					StatesData[j].push(lonely[i][j][1]);
				}
			}

			/*for (var i=0 ; i<StatesData ; i++)
			{
				 var dataValue = ((StatesData[i][0][1]/total[i])*100).toFixed(2);
				 DataValueArray.push(parseFloat(dataValue)); 
			}*/

	        StatesData.forEach(function(d,i) {
			    var dataValue = ((d[0]/total[i])*100).toFixed(2);
			    DataValueArray.push(parseFloat(dataValue)); 
			   // console.log(dataValue);
			});
   
			for(var i=0; i< lonely[0].length ; i++)
			{
				temp[i][1] = DataValueArray[i];
			}

	        return temp;
		
	}
	


	//https://bl.ocks.org/mbostock/3887235
	function drawPieChart(Transportdiv, clickedState)
	{
		var whatData = [];
		whatData[0] = "Lives Alone";
		whatData[1] = "Householder Living With Spouse or vice-versa";
		whatData[2] = "Householder Living With Unmarried Partner or vice-versa";
		whatData[3] = "Child of Householder";
		whatData[4] = "Other Relatives";
		whatData[5] = "Other Nonrelatives";
		//console.log("drawChart");


		var data = [];
		var legendRectSize = 10;
		var legendSpacing = 10;

		//console.log(lonely);
		data[0] = parseInt(lonely[0][clickedState][1]);
		data[1] = parseInt(lonely[1][clickedState][1]);
		data[2] = parseInt(lonely[2][clickedState][1]);
		data[3] = parseInt(lonely[3][clickedState][1]);
		data[4] = parseInt(lonely[4][clickedState][1]);
		data[5] = parseInt(lonely[5][clickedState][1]);

		//console.log(data);

		//console.log(data);
		var width = PieChartWidth-40,
		    height = PieChartHeight-40,
		    radius = Math.min(width, height) / 2;

		var color = d3.scaleOrdinal(d3.schemeCategory10);	

		var arc = d3.svg.arc()
		    .outerRadius(radius - 10)
		    .innerRadius(0);

		var labelArc = d3.arc()
		    .outerRadius(radius - 40)
		    .innerRadius(radius - 40);

		var pie = d3.pie()
		    .sort(null)
		    .value(function(d) { return d; });

		var tots = d3.sum(data);

		Transportdiv.append("h2")
			.attr("id","household")
			.html(lonely[0][clickedState][0]);

		var svg = Transportdiv.append('svg')
			.attr("class", "pie-area")
			.attr('width', width)
			.attr('height', height)
			.append('g')
			.attr('transform', 'translate(' + (width/2 ) +
					',' + (height/2) + ')')
			
			var g = svg.selectAll(".arc")
			  .data(pie(data))
			  .enter().append("g")
			  .attr("class", "arc");

			g.append('path')
			.attr('d', arc)
			.style("fill", function(d,i) { return color(i); })

			g.append("text")
			  .attr("transform", function(d) { return "translate(" + labelArc.centroid(d) + ")"; })
			  .attr("dy", ".35em")
			  .style("font-size", "9px")
				.text(function(d){ return parseFloat((d.value/tots)*100).toFixed(1)+"%"; });	

			

		Transportdiv.transition()		
			.duration(200)		
			.style("opacity", .9)		
			.style("left", (pieChartLocationX) + "px")		
			.style("top", (pieChartLocationY) + "px");

		var chart = d3.selectAll('.pie-area');
		var legend = chart.selectAll('.legend')
			.data(color.domain())
			.enter()
			.append('g')
			.attr('class', 'legend')
			.attr('transform', function(d, i) {
			var height = legendRectSize + legendSpacing;
			var offset =  height * color.domain().length / 2;
			var horz = 8 * legendRectSize;
			var vert = i * height + 200;
			return 'translate(' + horz + ',' + vert + ')';
			});

		legend.append('rect')
			.attr('width', legendRectSize)
			.attr('height', legendRectSize)
			.style('fill', color)
			.style('stroke', color)                                   // UPDATED (removed semicolon)                                                      // NEW
		legend.append('text')
			.attr('x', legendRectSize + legendSpacing)
			.attr('y', legendRectSize - legendSpacing + 5)
			.text(function(d,i) { return whatData[i]; });     

		
	}
	
    function ExtractData(json, variable)
    {
    	MinVal = 0;
    	MaxVal = 0;
		
		var DataValueArray=[];
		
		if(variable==Default)
		{
			for (var j = 0; j < json.features.length; j++)  {

				// Copy the data value into the JSON
				json.features[j].properties.dataValue = j*30; 
			}
				
			MinVal=0;
			MaxVal=1500;
		}
		else if(variable==0)
		{
			{
			for (var i = 0; i < AllStatesData[variable].length; i++) {

				// Grab State Name
				var dataState = AllStatesData[variable][i][0];

				// Grab data value 
				var dataValue = AllStatesData[variable][i][1];
				var MedianAge = AllStatesData[3][i][1];
				DataValueArray.push(parseFloat(dataValue)); 

				// Find the corresponding state inside the GeoJSON
				for (var j = 0; j < json.features.length; j++)  {
					var jsonState = json.features[j].properties.name;

					if (dataState == jsonState) {

							// Copy the data value into the JSON
							json.features[j].properties.dataValue = dataValue; 
							json.features[j].properties.MedianAge = MedianAge; 

							// Stop looking through the JSON
							break;
						}
					}
				}
			}
			 MinVal=d3.min(DataValueArray);
		     MaxVal=d3.max(DataValueArray);
		}
		else{
			for (var i = 0; i < AllStatesData[variable].length; i++) {

				// Grab State Name
				var dataState = AllStatesData[variable][i][0];

				// Grab data value 
				var dataValue = AllStatesData[variable][i][1];
				DataValueArray.push(parseFloat(dataValue)); 

				// Find the corresponding state inside the GeoJSON
				for (var j = 0; j < json.features.length; j++)  {
					var jsonState = json.features[j].properties.name;

					if (dataState == jsonState) {

					// Copy the data value into the JSON
					json.features[j].properties.dataValue = dataValue; 

					// Stop looking through the JSON
					break;
					}
				}
			}
			
			MinVal=d3.min(DataValueArray);
		   MaxVal=d3.max(DataValueArray);
		}
		

	}
	
	function ExtractDataSexDistribution(json, variable)
    {
    	MinVal = 0;
    	MaxVal = 0;
		
		var DataValueArray=[];
		var MaleVar = parseInt(variable);
		var FemaleVar = MaleVar+1;
		
		for (var i = 0; i < AllStatesData[MaleVar].length; i++) {

			// Grab State Name
			var dataState = AllStatesData[MaleVar][i][0];

			// Grab data value 
			var dataValue = (AllStatesData[MaleVar][i][1] / AllStatesData[FemaleVar][i][1]);
			
			DataValueArray.push(parseFloat(dataValue)); 

			// Find the corresponding state inside the GeoJSON
			for (var j = 0; j < json.features.length; j++)  {
				var jsonState = json.features[j].properties.name;

				if (dataState == jsonState) {

				// Copy the data value into the JSON
				json.features[j].properties.dataValue = dataValue; 

				// Stop looking through the JSON
				break;
				}
			}
		}
		
		MinVal=d3.min(DataValueArray);
		MaxVal=d3.max(DataValueArray);

	}
	function drawBarChartSexDistribution(Transportdiv, State)
	{
		var BarChartData = [];
		BarChartData.push(AllStatesData[2][State][1]);
		BarChartData.push(AllStatesData[1][State][1]);
		
		var MedianAge =[];
				
		MedianAge.push(AllStatesData[5][State][1]);
		MedianAge.push(AllStatesData[4][State][1]);	
		console.log(AllStatesData[4]);

		// find maximum values 
		var MaxValue = d3.max(BarChartData);
		var barWidth = (BarChartWidth)/(3);
		var z = d3.scale.category10();							

		var yScale = d3.scaleLinear()
				.domain([0,MaxValue])
				.range([BarChartHeight,0]);

		var xScale = d3.scaleBand()
			.domain(["male","female"])
			.range([0,BarChartWidth])
			.padding(0.4); 

		var group = Transportdiv.append("svg")
			.attr("class", "pie-area");

			group.append("g")
			.attr("transform", "translate(100, 100)");

		group.append("g").selectAll("g")
				    .data(BarChartData)
				    .enter().append("rect")
				    .style("fill", function(d, i) { return z(i); })
				    .attr("class","rect")
				    .attr("width", xScale.bandwidth())
				    .attr("height",function(d){
						return BarChartHeight - yScale(d);
					})
				    .attr("x", function(d, i) { 
				    	if (i == 0) return xScale("male");
				    	if (i==1) return xScale("female");
				    	return xScale(d); })
				    .attr("y", function(d) { return yScale(d); });

      		var x = d3.scale.ordinal()
			    .domain(["male","female"])
			    .rangeRoundBands([0, BarChartWidth],.1,.1);

			var	xAxis = d3.axisBottom();
			xAxis.scale(xScale);

			group.append("g")
				.attr('class', 'axis')
				.attr('transform', 'translate(0,' + BarChartHeight + ')')
				.call(xAxis)
				.append("text")
				.attr("x", BarChartWidth)
			    .attr("y", 10)
			    .attr("dy", ".71em")
		        .style("text-anchor", "middle")
		        .style("font-size", "10px");

		    var	yAxis = d3.axisLeft();
			yAxis.scale(yScale);

			group.append("g")
				.attr('class', 'axis')
				.attr('transform', 'translate(-2,0)')
				.call(yAxis)
				.append("text")
			    .attr("transform", "rotate(-90)")
			    .attr("y", 6)
			    .attr("dy", ".71em")
		        .style("text-anchor", "middle")
		        .style("font-size", "12px")
	   	        .text();
			;
			console.log(MedianAge);
			group.append("g").selectAll("text")
               .data(MedianAge)
               .enter()
               .append("text")
               .html(function(d){ return d;})
               .attr("text-anchor", "middle")
               .attr("x", function(d,i){return xScale.bandwidth() + i*200})
               .attr("y",100)
               .attr("font-family", "sans-serif")
               .attr("font-size", "24px")
               .attr("fill", "white");

			Transportdiv.transition()		
						.duration(200)		
						.style("opacity", .9)		
						.style("left", (pieChartLocationX) + "px")		
						.style("top", (pieChartLocationY) + "px");

		/*
		var chart = d3.select(".chart")
			.attr("width", BarChartWidth);

		  chart.attr("height", BarChartHeight);

		  var bar = chart.selectAll("#third")
			  .data(BarChartData)
			.enter().append("g")
			.attr("transform", function(d, i) { return "translate(0," + i * BarChartHeight + ")"; });

		  bar.append("rect")
			  .attr("width", function(d) { return x(d.Value); })
			  .attr("height", BarChartHeight - 1);

		  bar.append("text")
			  .attr("x", function(d) { return x(d.Sex) - 3; })
			  .attr("y", BarChartHeight / 2)
			  .attr("dy", ".35em")
			  .text(function(d) { return d.Value; });*/

	}
		
	function drawMap(json,colorVar)
	{
		//https://bl.ocks.org/michellechandra/0b2ce4923dc9b5809922
		//Width and height of map
		var width = MapWidth;//1500;//960;
		var height = MapHeight;//800;//500;

		// D3 Projection
		var projection = d3.geo.albersUsa()
						   .translate([width/2, height/2])    // translate to center of screen
						   .scale([MapScale]);          // scale things down so see entire US
		        
		// Define path generator
		var path = d3.geo.path()               // path generator that will convert GeoJSON to SVG paths
				  	 .projection(projection);  // tell path generator to use albersUsa projection

		var Transportdiv = d3.select("body")
					.append("div")
					.attr("class", "pie-tooltip")               
					.style("opacity", 0);

		if(colorVar == 1 )		
		{
			// Define linear scale for output
			var color = d3.scale.sqrt().range(myColors[colorVar]);
			color.domain([MinVal,0.99999,1,MaxVal]); // setting the range of the input data
		}else
		{
			// Define linear scale for output
			var color = d3.scale.linear().range(myColors[colorVar]);
			color.domain([MinVal, MaxVal]); // setting the range of the input data
		}		

		//Create SVG element and append map to the SVG
		var svg = d3.select("#main")
					.append("svg")
					.attr("width", width)
					.attr("height", height);
				
		// Append Div for tooltip to SVG
		var div = d3.select("body")
					.append("div")   
					.attr("class", "Populationtooltip")               
					.style("opacity", 0);
					
		// Bind the data to the SVG and create one path per GeoJSON feature
		svg.selectAll("path")
			.data(json.features)
			.enter()
			.append("path")
			.attr("d", path)
			.attr("class", "states")
			.style("stroke", "#fff")
			.style("stroke-width", "1")
			.style("fill", function(d) {

			// Get data value
			var value = d.properties.dataValue;

				if (value) {
				//If value exists…
				return color(value);
				} else {
				//If value is undefined…
				return "rgb(213,222,217)";
				}
			})
			.on('mouseover', function(d,i){
					div.transition()		
						.duration(200)		
						.style("opacity", .9);		
					if(colorVar==0)
					{
						div.html(d.properties.name+"</br>"+d.properties.dataValue+"</br>"+d.properties.MedianAge)
						.style("left", (pieChartLocationX-200) + "px")		
						.style("top", (pieChartLocationY) + "px");
					}
				    else{
					div.html(d.properties.name+"</br>"+d.properties.dataValue)
						.style("left", (pieChartLocationX-200) + "px")		
						.style("top", (pieChartLocationY) + "px");
					}
					
					if(colorVar==1)
					{
						drawBarChartSexDistribution(Transportdiv,i);
					}
					if(colorVar==2)
					{
						drawPieChart(Transportdiv, i);
					}

			})
			.on('mouseout', function(d) {		
							div.transition()		
								.duration(500)		
								.style("opacity", 0);
								
							Transportdiv.transition()		
								.duration(500)		
								.style("opacity", 0);

							d3.selectAll(".pie-area").remove();
							d3.selectAll("#pie-heading").remove();
							d3.selectAll("#household").remove();
			});			
			
			/*if(parseInt(colorVar)==2)
			{
				svg.on('click', function(d,i) {		
					d3.select("#third").selectAll('g').remove();
					drawBarChartSexDistribution(Transportdiv, i);
			});
			}else
			{
				svg.on('click', function(d,i) {		
					d3.select("#third").selectAll('g').remove();
					
			});
			}*/
		 
	}

	//Divi Changes begin here 
	function ExtactTransportData(json,transportData)
    {
        TransMinVal = 0;
    	TransMaxVal = 0;
        var transDataArray = [];
        //var TDataValueArray=[];
		  for (var k = 0; k < transportData.length; k++){
            var tempData = transportData[k];
			for (var i = 1; i < tempData.length; i++) {
				// Grab State Name
				var TransportdataState = tempData[i][0];
				// Grab data value 
				var TransportDataValue = tempData[i][1];
                if (k == 0){
                    transDataArray.push(parseFloat(TransportDataValue));
                }
				//TDataValueArray.push(parseFloat(TransportdataValue)); 
				// Find the corresponding state inside the GeoJSON
				for (var j = 0; j < json.features.length; j++)  {
					var jsonState = json.features[j].properties.name;
					if (TransportdataState == jsonState) {
					// Copy the data value into the JSON
                        switch(k){
                            case 0:
                                json.features[j].properties.TransportDataValue={"Total" : TransportDataValue};
                                json.features[j].properties.TransportDataValue["Distribution"] = [];
								json.features[j].properties.TransportDataValue["carpoolDetails"] = [];
                                break;
                            case 1:
								json.features[j].properties.TransportDataValue["Distribution"].push({"label": "CarAlone", "value": TransportDataValue})
								break;
                            case 2:
								json.features[j].properties.TransportDataValue["Distribution"].push({"label": "Carpooled", "value": TransportDataValue});
								break;
                             case 3:
								json.features[j].properties.TransportDataValue["Distribution"].push({"label": "Public", "value": TransportDataValue});
								break;
                            case 4:
								json.features[j].properties.TransportDataValue["Distribution"].push({"label": "Taxicab", "value": TransportDataValue});
								break;
                            case 5:
								json.features[j].properties.TransportDataValue["Distribution"].push({"label": "Motorcycle", "value": TransportDataValue});
								break;
                            case 6:
								json.features[j].properties.TransportDataValue["Distribution"].push({"label": "Bicycle", "value": TransportDataValue});
								break;
                            case 7:
								json.features[j].properties.TransportDataValue["Distribution"].push({"label": "Walk", "value": TransportDataValue});
								break;
                            case 8:
								json.features[j].properties.TransportDataValue["Distribution"].push({"label": "Other", "value": TransportDataValue});
								break;
                            case 9:
								json.features[j].properties.TransportDataValue["Distribution"].push({"label": "athome", "value": TransportDataValue});
								break;
							case 10:
								json.features[j].properties.TransportDataValue["medianHouseholdIncome"] = TransportDataValue;
								break;
							case 11:
								json.features[j].properties.TransportDataValue["carpoolDetails"].push({"label": "2", "value": TransportDataValue});
								break;
                            case 12:
								json.features[j].properties.TransportDataValue["carpoolDetails"].push({"label": "3", "value": TransportDataValue});
								break;
                            case 13:
								json.features[j].properties.TransportDataValue["carpoolDetails"].push({"label": "4", "value": TransportDataValue});
								break;
                            case 14:
								json.features[j].properties.TransportDataValue["carpoolDetails"].push({"label": "5or6", "value": TransportDataValue});
								break;
                            case 15:
								json.features[j].properties.TransportDataValue["carpoolDetails"].push({"label": "7", "value": TransportDataValue});
								break;							
                        }
                        break;
					}
				}
			}}

		//console.log(json);
        TransMinVal = d3.min(transDataArray);
        //console.log("Minvalue"+TransMinVal);
    	TransMaxVal = d3.max(transDataArray);
        //console.log("Maxvalue"+TransMaxVal);
	}
	function drawTransportMap(json,colorVar)
	{

        //console.log("Draw transport map");
		//https://bl.ocks.org/michellechandra/0b2ce4923dc9b5809922
		//Width and height of map
		var width = MapWidth;//960;
		var height = MapHeight;//500;
		// D3 Projection

		var projection = d3.geo.albersUsa()
						   .translate([width/2, height/2])    // translate to center of screen
						   .scale([MapScale]);          // scale things down so see entire US

		// Define path generator

		var path = d3.geo.path()               // path generator that will convert GeoJSON to SVG paths
				  	 .projection(projection);  // tell path generator to use albersUsa projection
		// Define linear scale for output

		var color = d3.scale.linear()
					  .range(myColors[colorVar]);

		color.domain([TransMinVal, TransMaxVal]); // setting the range of the input data

		//Create SVG element and append map to the SVG

		var svg = d3.select("#main")
					.append("svg")
					.attr("id", "transportmap")
					.attr("width", width + 400)
					.attr("height", height);

		// Append Div for tooltip to SVG

		var Transportdiv = d3.select("body")
					.append("div")   
					.attr("class", "pie-tooltip")               
					.style("opacity", 0);

		// Bind the data to the SVG and create one path per GeoJSON feature

		svg.selectAll("path")
			.data(json.features)
			.enter()
			.append("path")
			.attr("d", path)
			.attr("class", "states")
			.style("stroke", "#fff")
			.style("stroke-width", "1")
			.style("fill", function(d) {
			// Get data value
			var value = d.properties.TransportDataValue.Total;
				if (value) {
				//If value exists…
					return color(value);
				} else {
				//If value is undefined…
					return "rgb(213,222,217)";
				}
			})
			.on("click", function(d,i){
				drawTransportBarChart(d);
			})
			.on('mouseover', function(d,i) {
				drawHoverPieChart(Transportdiv,d);
            })			
			.on('mouseout', function(d) {		
							Transportdiv.transition()		
								.duration(500)		
								.style("opacity", 0);
                            d3.selectAll(".pie-area").remove();
							d3.selectAll("#pie-heading").remove();
							d3.selectAll("#household").remove();

			});
			//Append a defs (for definition) element to your SVG
			var defs = svg.append("defs");

			//Append a linearGradient element to the defs and give it a unique id
			var diff = TransMaxVal - TransMinVal;
			var linearGradient = defs.append("linearGradient")
				.attr("id", "linear-gradient");
			linearGradient
				.attr("x1", "0%")
				.attr("y1", "0%")
				.attr("x2", "0%")
				.attr("y2", "100%");
			//Set the color for the start (0%)
			linearGradient.append("stop") 
				.attr("offset", "0%")   
				.attr("stop-color", function(){
					return color(TransMinVal);
				});
			linearGradient.append("stop") 
				.attr("offset", "25%")   
				.attr("stop-color", function(){
					return color(TransMinVal + diff/4);
				});
			linearGradient.append("stop") 
				.attr("offset", "50%")   
				.attr("stop-color", function(){
					return color(TransMinVal + diff/2);
				});
			linearGradient.append("stop") 
				.attr("offset", "75%")   
				.attr("stop-color", function(){
					return color(TransMinVal + 3*(diff/4));
				}); //light blue
			//Set the color for the end (100%)
			linearGradient.append("stop") 
				.attr("offset", "100%")   
				.attr("stop-color", function(){
					return color(TransMaxVal);
				}); //dark blue
			var legnd_width = 10;
			var legend_height = 600;
			svg.append("rect")
				.attr("width", legnd_width)
				.attr("height", legend_height)
				.style("fill", "url(#linear-gradient)")
				.attr("transform", "translate(5,20)");
			svg.append("text")
				.html(TransMinVal)
				.style("font-weight", "bold")
				.style("font-size", "10px")
				.attr("transform", "translate(0,30)");
			svg.append("text")
				.style("font-weight", "bold")
				.style("font-size", "10px")
				.html(Math.round(TransMinVal + diff/4))
				.attr("transform", "translate(0,"+ (20 + (legend_height/4))+")");
			svg.append("text")
				.style("font-weight", "bold")
				.style("font-size", "10px")
				.html(Math.round(TransMinVal + diff/2))
				.attr("transform", "translate(0,"+ (20 + (legend_height/2))+")");
			svg.append("text")
				.style("font-weight", "bold")
				.style("font-size", "10px")
				.html(Math.round(TransMinVal + 3*(diff/4)))
				.attr("transform", "translate(0,"+ (20 + 3*(legend_height/4))+")");
			svg.append("text")
				.style("font-weight", "bold")
				.style("font-size", "10px")
				.html(TransMaxVal)
				.attr("transform", "translate(0,"+ (legend_height) +")");
			svg.append("text")
				.html("Overall Transportation Distribution")
				.style("font-size", "14px")
				.style("font-weight", "bold")
				.attr("transform", "translate("+ width/3+" ,50)")
			svg.append("text")
				.html("Transport Density ")
				.attr("transform", "translate(0 ,10)")
		//write in a seperate function
	}
	function drawTransportBarChart(tpiedata){
		
		// set the dimensions and margins of the graph
			var margin = {top: 15, right: 10, bottom: 20, left: 60},
				width = 300 - margin.left - margin.right,
				height = 300 - margin.top - margin.bottom;
			var transportPieData = tpiedata.properties.TransportDataValue.carpoolDetails;
			var Carpooled = tpiedata.properties.TransportDataValue.Distribution[1].value;
			var total = tpiedata.properties.TransportDataValue.Total;
			var public = tpiedata.properties.TransportDataValue.Distribution[2].value;
			var state = tpiedata.properties.name;
			// set the ranges
			var x = d3.scaleBand()
					.range([0, width])
					.padding(0.2);
			var y = d3.scaleLinear()
					.range([height, 0]);
			//console.log("Transport Bar Chart Data ");
			//console.log(transportPieData);
			// append the svg object to the body of the page
			// append a 'group' element to 'svg'
			// moves the 'group' element to the top left margin
			var svg = d3.select("#multi-wrapper").append("svg")
				.attr("width", width + margin.left + margin.right)
				.attr("height", height + margin.top + margin.bottom)
				.style("margin-left", margin.left);
			
			// format the data
			transportPieData.forEach(function(d) {
				d.value = +d.value;
			});

			// Scale the range of the data in the domains
			x.domain(transportPieData.map(function(d) { return d.label; }));
			y.domain([0, d3.max(transportPieData, function(d) { return d.value; })]);

			// append the rectangles for the bar chart
			
			var bar = svg.selectAll("g")
				.data(transportPieData)
				.enter().append("g")
		//		.attr("transform", "translate("+ margin.left +"," + margin.top + ")");

				bar.append("rect")
					.attr("class", "bar")
					.attr("x", function(d) { return x(d.label); })
					.attr("width", x.bandwidth())
					.attr("y", function(d) { return y(d.value); })
					.attr("height", function(d) { return height - y(d.value); });
				bar.append("text")
					.attr("x", function(d) { return x(d.label) + 3; })
					.attr("y", function(d) { 
						if (Math.round((parseInt(d.value)/parseInt(Carpooled))*100) > 10){
							return y(d.value) + 20;
						}else{
							return y(d.value) - 3 ;
						}})
					.style("color", "red")
					.text(function(d) { return Math.round(((d.value/total)*100)*100)/100 + "%"; })
					.style('font-size','14px')
					.style('font-weight', 'bold');
			// add the x Axis
			svg.append("g")
				.attr("transform", "translate(0," + height + ")")
				.call(d3.axisBottom(x))
				.style('font-weight','10px')
				.append("text")
				.text("# of people carpooled");

			// add the y Axis
			svg.append("text")
				.attr("x", (width / 3))             
				.attr("y", margin.top)
				.attr("text-anchor", "left")  
				.style("font-size", "14px")
				.style('font-weight', 'bold')
				.text("Distribution of Carpool in");
			svg.append("text")
				.attr("x", (width / 3))             
				.attr("y", margin.top + 20)
				.attr("text-anchor", "left")  
				.style("font-size", "14px")
				.style('font-weight', 'bold')
				.text(state);
			svg.append("text")
				.attr("x", (width / 3))             
				.attr("y", margin.top + 40)
				.attr("text-anchor", "left")  
				.style("font-size", "12px") 
				.text("Total Public Transport: " + Math.round((public/total)*100) + "%");
			svg.append("text")
				.attr("x", (width / 3))             
				.attr("y", margin.top +  60)
				.attr("text-anchor", "left")  
				.style("font-size", "12px") 
				.text("Total Carpooled Transport: " + Math.round((Carpooled/total)*100) + "%");
	}
	function drawTimetoTravelBarChart(timedata){
		//console.log(timedata);
		// set the dimensions and margins of the graph
			var margin = {top: 15, right: 10, bottom: 100, left: 60},
				width = 500 - margin.left - margin.right,
				height = 500 - margin.top - margin.bottom;
			var travelBarData = timedata.features;
			var totalCategories = [];
			var totalValues = [0,0,0,0,0,0,0,0,0,0,0,0];
			var totalTimeTaken = 0;
			//console.log(travelBarData.length);
			for(var i = 0; i < travelBarData.length; i++){
				var temp = travelBarData[i].properties.TimeToTravelDataValue.Distribution;
				totalTimeTaken = parseFloat(totalTimeTaken) + parseFloat(travelBarData[i].properties.TimeToTravelDataValue.Total);
				for(var j = 0; j < temp.length; j++){
					if(i == 0){
						totalCategories.push(temp[j].label);
					}
					totalValues[j] = parseFloat(totalValues[j]) + parseFloat(temp[j].value);
				}
			}
			
			/*console.log(totalCategories);
			console.log(totalValues);
			console.log(totalTimeTaken);
			console.log(d3.sum(totalValues));*/

			var TotalArray = [];
			
			for (var i = 0; i < totalCategories.length; i++){
				var Timetotraveobj = {};
				Timetotraveobj.label = totalCategories[i];
				Timetotraveobj.value = totalValues[i];
				TotalArray.push(Timetotraveobj);
			}
			console.log(TotalArray);
			// set the ranges
			var x = d3.scaleBand()
					.range([0, width])
					.padding(0.2);
			var y = d3.scaleLinear()
					.range([height, 0]);
					
			// append the svg object to the body of the page
			// append a 'group' element to 'svg'
			// moves the 'group' element to the top left margin
			var svg = d3.select("#multi-wrapper").append("svg")
				.attr("width", width + margin.left + margin.right)
				.attr("height", height + margin.top + margin.bottom + 40)
				.style("margin-left", margin.left)
				.style("border","1px solid black");
			
			// format the data
			TotalArray.forEach(function(d) {
				d.value = +d.value;
			});

			// Scale the range of the data in the domains
			x.domain(TotalArray.map(function(d) { return d.label; }));
			y.domain([0, d3.max(TotalArray, function(d) { return d.value; })]);

			// append the rectangles for the bar chart
			
			var bar = svg.selectAll("g")
				.data(TotalArray)
				.enter().append("g")
				.attr("transform", "translate(0," + (margin.top + 30)+ ")");

				bar.append("rect")
					.attr("class", "bar")
					.attr("x", function(d) { return x(d.label); })
					.attr("width", x.bandwidth())
					.attr("y", function(d) { return y(d.value); })
					.attr("height", function(d) { return height - y(d.value); });
				bar.append("text")
					.attr("x", function(d) { return x(d.label); })
					.attr("y", function(d) { 
							return y(d.value) -2;})
					.style("color", "red")
					.text(function(d) { return Math.round(((d.value/totalTimeTaken)*100)*100)/100 + "%"; })
					.style('font-size','14px')
					.style('font-weight', 'bold');
			// add the x Axis
			svg.append("g")
				.attr("transform", "translate(0," + (height + 44 ) + ")")
				.call(d3.axisBottom(x))
					.selectAll("text")	
					.style("text-anchor", "end")
					.attr("dx", "-.8em")
					.attr("dy", ".15em")
					.attr("transform", "rotate(-85)");

			// add the y Axis
			svg.append("text")
				.attr("x", (width / 2))             
				.attr("y", margin.top)
				.attr("text-anchor", "left")  
				.style("font-size", "14px")
				.style('font-weight', 'bold')
				.text("Overall Time to travel Distribution");
	//			.text("Total Carpooled Transport: " + Math.round((Carpooled/total)*100) + "%");
			// set the ranges

	}
	function drawHoverPieChart(Transportdiv,d){
		            //starts here
					var width = 250;
					var height = 250;
					var radius = Math.min(width, height) / 2;
					var donutWidth = 25;
					var legendRectSize = 10;
					var legendSpacing = 10;
					var color = d3.scaleOrdinal(d3.schemeCategory10);
					var arc = d3.arc()
						.innerRadius(radius - donutWidth)
						.outerRadius(radius);
					var pie = d3.pie()
						.value(function(d) { return parseInt(d.value); })
						.sort(null);
			//ends here
					var tot = d.properties.TransportDataValue.Total;
					Transportdiv.append("h1")
						.attr("id","pie-heading")
						.style("font-size", "24px")
						.html(d.properties.name);
					Transportdiv.append("h2")
						.attr("id","household")
						.html("Total: " + tot);

					Transportdiv.append('svg')
						.attr("class", "pie-area")
						.attr('width', width)
						.attr('height', height)
						.append('g')
          				.attr('transform', 'translate(' + (width/2 ) +
            					',' + (height/2) + ')')
						.selectAll('path')
						.data(pie(d.properties.TransportDataValue.Distribution))
						.enter()
						.append('path')
						.attr('d', arc)
						.attr('fill', function(d, i) {
							return color(d.data.label + ": " + Math.round((d.data.value/tot)*100) + "%");})

					Transportdiv.transition()		
						.duration(200)		
						.style("opacity", .9)		
						.style("left", (pieChartLocationX) + "px")		
						.style("top", (pieChartLocationY) + "px");

					var chart = d3.selectAll('.pie-area');
					var legend = chart.selectAll('.legend')
						.data(color.domain())
						.enter()
						.append('g')
						.attr('class', 'legend')
						.attr('transform', function(d, i) {
						var height = legendRectSize + legendSpacing;
						var offset =  height * color.domain().length / 2;
						var horz = 8 * legendRectSize;
						var vert = i * height + 50;
						return 'translate(' + horz + ',' + vert + ')';
						});

					legend.append('rect')
						.attr('width', legendRectSize)
						.attr('height', legendRectSize)
						.style('fill', color)
						.style('stroke', color)                                   // UPDATED (removed semicolon)                                                      // NEW
					legend.append('text')
						.attr('x', legendRectSize + legendSpacing)
						.attr('y', legendRectSize - legendSpacing + 5)
						.text(function(d) { return d; });
					//
	}
	function drawMedianBarChart(json){
		var obj = {};
		var categories= [];
		var dollars = [];
		d3.map(json.features, function(d){
			categories.push(d.properties.TimeToTravelDataValue.Distribution.label); 
			dollars.push(d.properties.TransportDataValue.medianHouseholdIncome);
			});
		var colors = ['#0000b4','#0082ca','#0094ff','#0d4bcf','#0066AE','#074285','#00187B','#285964','#405F83','#416545','#4D7069','#6E9985','#7EBC89','#0283AF','#79BCBF','#99C19E'];

		var grid = d3.range(dollars.length).map(function(i){
			return {'x1':0,'y1':0,'x2':0,'y2':480};
		});

		var tickVals = grid.map(function(d,i){
			if(i>0){ return i*10; }
			else if(i===0){ return "100";}
		});

		var barChartMin = d3.min(dollars);
		var barChartMax = d3.max(dollars);
		var xscale = d3.scaleLinear()
						.domain([barChartMin,barChartMax])
						.range([0,250]);

		var yscale = d3.scaleLinear()
						.domain([0,categories.length])
						.range([0,1000]);

		var colorScale = d3.scaleQuantize()
						.domain([0,categories.length])
						.range(colors);

		var canvas = d3.select('#wrapper')
						.append('svg')
						.attr("id", "bargraph")
						.attr('width',280)
						.attr('height',1000);

		var	xAxis = d3.axisBottom();
			xAxis
				.scale(xscale)
				.tickValues(tickVals);

		var	yAxis = d3.axisLeft();
			yAxis.scale(yscale)
				.tickSize(2)
				.tickFormat(function(d,i){ return categories[i]; })
				.tickValues(d3.range(17));

		var y_xis = canvas.append('g')
						  .attr("transform", "translate(15,15)")
						  .attr('id','yaxis')
						  .call(yAxis);

		var x_xis = canvas.append('g')
						 .attr("transform", "translate(15,0)")
						 .attr('id','xaxis')
					     .call(xAxis);

		var chart = canvas.append('g')
							.attr("transform", "translate(15,15)")
							.attr('id','bars')
							.selectAll('rect')
							.data(dollars)
							.enter()
							.append('rect')
							.attr('height',10)
							.attr('x', 0)
							.attr('y',function(d,i){ return yscale(i)+0.9; })
							.style('fill',function(d,i){ return colorScale(i); })
							.attr('width',function(d){ return 0; });

		var transit = d3.select("#bargraph").selectAll("rect")
						    .data(dollars)
						    .transition()
						    .duration(1000) 
						    .attr("width", function(d) {return xscale(d);  });

		var transitext = d3.select('#bars')
							.selectAll('text')
							.data(dollars)
							.enter()
							.append('text')
							.attr('x',function(d) {return xscale(d); })
							.attr('y',function(d,i){ return yscale(i)+7; })
							.text(function(d){ return d+"$"; })
							.style('fill','#fff')
							.style('font-size','14px');
	}
	function ExtractTimeToTravelData(json,timeToTravelData)
    { 
        TimeToTravelMinVal = 0;
    	TimeToTravelMaxVal = 0;
        var TimeToTravelDataArray = [];
		  for (var k = 0; k < timeToTravelData.length; k++){
            var tempData = timeToTravelData[k];
			for (var i = 1; i < tempData.length; i++) {
				// Grab State Name
				var TimeToTravelDataState = tempData[i][0];
				// Grab data value 
				var TimeToTravelDataValue = tempData[i][1];
                if (k == 0){
                    TimeToTravelDataArray.push(parseFloat(TimeToTravelDataValue));
                }
				//TDataValueArray.push(parseFloat(TransportdataValue)); 
				// Find the corresponding state inside the GeoJSON
				for (var j = 0; j < json.features.length; j++)  {
					var jsonState = json.features[j].properties.name;
					if (TimeToTravelDataState == jsonState) {
					// Copy the data value into the JSON
                        switch(k){
                            case 0:
                                json.features[j].properties.TimeToTravelDataValue={"Total" : TimeToTravelDataValue};
                                json.features[j].properties.TimeToTravelDataValue["Distribution"] = [];
                                break;
                            case 1:
								json.features[j].properties.TimeToTravelDataValue["Distribution"].push({"label": "Less_than_5_minutes", "value": TimeToTravelDataValue})
								break;
                            case 2:
								json.features[j].properties.TimeToTravelDataValue["Distribution"].push({"label": "5 to 9 Minutes", "value": TimeToTravelDataValue});
								break;
                             case 3:
								json.features[j].properties.TimeToTravelDataValue["Distribution"].push({"label": "10 to 14 Minutes", "value": TimeToTravelDataValue});
								break;
                            case 4:
								json.features[j].properties.TimeToTravelDataValue["Distribution"].push({"label": "15 to 19 Minutes", "value": TimeToTravelDataValue});
								break;
                            case 5:
								json.features[j].properties.TimeToTravelDataValue["Distribution"].push({"label": "20 to 24 Minutes", "value": TimeToTravelDataValue});
								break;
                            case 6:
								json.features[j].properties.TimeToTravelDataValue["Distribution"].push({"label": "25 to 29 Minutes", "value": TimeToTravelDataValue});
								break;
                            case 7:
								json.features[j].properties.TimeToTravelDataValue["Distribution"].push({"label": "30 to 34 Minutes", "value": TimeToTravelDataValue});
								break;
                            case 8:
								json.features[j].properties.TimeToTravelDataValue["Distribution"].push({"label": "35 to 39 Minutes", "value": TimeToTravelDataValue});
								break;
                            case 9:
								json.features[j].properties.TimeToTravelDataValue["Distribution"].push({"label": "40 to 44 Minutes", "value": TimeToTravelDataValue});
								break;
							case 10:
								json.features[j].properties.TimeToTravelDataValue["Distribution"].push({"label": "45 to 59 Minutes", "value": TimeToTravelDataValue});
								break;
                            case 11:
								json.features[j].properties.TimeToTravelDataValue["Distribution"].push({"label": "60 to 89 Minutes", "value": TimeToTravelDataValue});
								break;
                            case 12:
								json.features[j].properties.TimeToTravelDataValue["Distribution"].push({"label": "90 or More Minutes", "value": TimeToTravelDataValue});
								break;
                        }
                        break;
					}
				}
			}}
        //console.log("New total update");
        TimeToTravelMinVal = d3.min(TimeToTravelDataArray);
        //console.log("Minvalue"+TimeToTravelMinVal);
    	TimeToTravelMaxVal = d3.max(TimeToTravelDataArray);
        //console.log("Maxvalue"+TimeToTravelMaxVal);
	}
    //TimeToTravel Extract Ends here
	function drawTimeToTravelMap(json,colorVar)
	{
		drawTimetoTravelBarChart(json);
        console.log("drawTimeToTravelMap");
		//Width and height of map
		var width = MapWidth;//960;
		var height = MapHeight;//500;
		// D3 Projection
		var projection = d3.geo.albersUsa()
						   .translate([width/2, height/2])    // translate to center of screen
						   .scale([MapScale]);          // scale things down so see entire US
         console.log("drawTimeToTravelMap1");
		// Define path generator
		var path = d3.geo.path()               // path generator that will convert GeoJSON to SVG paths
				  	 .projection(projection);  // tell path generator to use albersUsa projection
		// Define linear scale for output
		var color = d3.scale.linear()
					  .range(myColors[colorVar]);
		color.domain([TimeToTravelMinVal, TimeToTravelMaxVal]); // setting the range of the input data
        console.log("drawTimeToTravelMap2");
		//Create SVG element and append map to the SVG
		var svg = d3.select("#main")
					.append("svg")
					.attr("id", "timetotravel")
					.attr("width", width + 400 )
					.attr("height", height);
                console.log("drawTimeToTravelMap3");
		// Append Div for tooltip to SVG
		var TimeToTraveldiv = d3.select("body")
					.append("div")   
					.attr("class", "Time-pie-tooltip")               
					.style("opacity", 0);
		// Bind the data to the SVG and create one path per GeoJSON feature
                console.log("drawTimeToTravelMap4");

		svg.selectAll("path")
			.data(json.features)
			.enter()
			.append("path")
			.attr("d", path)
			.attr("class", "states")
			.style("stroke", "#fff")
			.style("stroke-width", "1")
			.style("fill", function(d) {
			// Get data value
			console.log("Printing TimeToTrave d value");
			var value = d.properties.TimeToTravelDataValue.Total;
				if (value) {
				//If value exists…
				return color(value);
				} else {
				//If value is undefined…
				return "rgb(213,222,217)";
				}
			})

			.on('mouseover', function(d,i){
            //starts here
					var width = 350;
					var height = 350;
					var radius = Math.min(width, height) / 2;
					var donutWidth = 25;
					var legendRectSize = 11;
					var legendSpacing = 10;
					var color = d3.scaleOrdinal(d3.schemeCategory20c);
					var arc = d3.arc()
						.innerRadius(radius - donutWidth)
						.outerRadius(radius);

					var pie = d3.pie()
						.value(function(d) { return parseInt(d.value); })
						.sort(null);

			//ends here
					var tot = d.properties.TimeToTravelDataValue.Total;

					TimeToTraveldiv.append("h1")
						.attr("id","pie-heading")
						.style("font-size", "24px")
						.html(d.properties.name);
					TimeToTraveldiv.append("h2")
						.attr("id","Commutetime")
						.html("OverAllCommuteInfo: " + d.properties.TimeToTravelDataValue.Total);

					TimeToTraveldiv.append('svg')
						.attr("class", "pie-area")
						.attr('width', width)
						.attr('height', height)
						.append('g')
          				.attr('transform', 'translate(' + (width/2 ) +
            					',' + (height/2) + ')')
						.selectAll('path')
						.data(pie(d.properties.TimeToTravelDataValue.Distribution))
						.enter()
						.append('path')
						.attr('d', arc)
						.attr('fill', function(d, i) {
							return color(d.data.label + ": " + Math.round((d.data.value/tot)*100) + "%");})

					TimeToTraveldiv.transition()		
						.duration(200)		
						.style("opacity", .9)		
						.style("left", (pieChartLocationX) + "px")		
						.style("top", (pieChartLocationY) + "px");
					var chart = d3.selectAll('.pie-area');

					var legend = chart.selectAll('.legend')
						.data(color.domain())
						.enter()
						.append('g')
						.attr('class', 'legend')
						.attr('transform', function(d, i) {
						var height = legendRectSize + legendSpacing;
						var offset =  height * color.domain().length / 2;
						var horz = 8 * legendRectSize;
						var vert = i * height + 50;
						return 'translate(' + horz + ',' + vert + ')';
						});

					legend.append('rect')
						.attr('width', legendRectSize)
						.attr('height', legendRectSize)
						.style('fill', color)
						.style('stroke', color)                                   // UPDATED (removed semicolon)                                                      
					legend.append('text')
						.attr('x', legendRectSize + legendSpacing)
						.attr('y', legendRectSize - legendSpacing + 5)
						.text(function(d) { return d; });
            })			
			.on('mouseout', function(d) {		
							TimeToTraveldiv.transition()		
								.duration(500)		
								.style("opacity", 0);
                            d3.selectAll(".pie-area").remove();
							d3.selectAll("#pie-heading").remove();
							d3.selectAll("#Commutetime").remove();
			});
						//Append a defs (for definition) element to your SVG
			var defs = svg.append('g')
						.append("defs");

			//Append a linearGradient element to the defs and give it a unique id
			var diff = TimeToTravelMaxVal - TimeToTravelMinVal;
			var linearGradient = defs.append("linearGradient")
				.attr("id", "linear-gradient");
			linearGradient
				.attr("x1", "0%")
				.attr("y1", "0%")
				.attr("x2", "0%")
				.attr("y2", "100%");
			//Set the color for the start (0%)
			linearGradient.append("stop") 
				.attr("offset", "0%")   
				.attr("stop-color", function(){
					return color(TimeToTravelMinVal);
				});
			linearGradient.append("stop") 
				.attr("offset", "25%")   
				.attr("stop-color", function(){
					return color(TimeToTravelMinVal + diff/4);
				});
			linearGradient.append("stop") 
				.attr("offset", "50%")   
				.attr("stop-color", function(){
					return color(TimeToTravelMinVal + diff/2);
				});
			linearGradient.append("stop") 
				.attr("offset", "75%")   
				.attr("stop-color", function(){
					return color(TimeToTravelMinVal + 3*(diff/4));
				}); //light blue
			//Set the color for the end (100%)
			linearGradient.append("stop") 
				.attr("offset", "100%")   
				.attr("stop-color", function(){
					return color(TimeToTravelMaxVal);
				}); //dark blue
			var legnd_width = 10;
			var legend_height = 600;
			var x_transform = 900;
			svg.append("rect")
				.attr("width", legnd_width)
				.attr("height", legend_height)
				.style("fill", "url(#linear-gradient)")
				.attr("transform", "translate(5,20)");
			svg.append("text")
				.style("font-size", "10px")
				.style("font-weight", "bold")
				.html(TimeToTravelMinVal)
				.attr("transform", "translate(0,30)");
			svg.append("text")
				.style("font-size", "10px")
				.style("font-weight", "bold")
				.html(Math.round(TimeToTravelMinVal + diff/4))
				.attr("transform", "translate(0,"+ (20 + (legend_height/4))+")");
			svg.append("text")
				.style("font-size", "10px")
				.style("font-weight", "bold")
				.html(Math.round(TimeToTravelMinVal + diff/2))
				.attr("transform", "translate(0,"+ (20 + (legend_height/2))+")");
			svg.append("text")
				.style("font-size", "10px")
				.style("font-weight", "bold")
				.html(Math.round(TimeToTravelMinVal + 3*(diff/4)))
				.attr("transform", "translate(0,"+ (20 + 3*(legend_height/4))+")");
			svg.append("text")
				.style("font-size", "10px")
				.style("font-weight", "bold")
				.html(TimeToTravelMaxVal)
				.attr("transform", "translate(0,"+ (legend_height) +")");
			svg.append("text")
				.html("Commute Time Distribution")
				.style("font-size", "14px")
				.style("font-weight", "bold")
				.attr("transform", "translate("+ width/2+" ,50)")
			svg.append("text")
				.style("font-size", "10px")
				.style("font-weight", "bold")
				.html("No. of people commute")
				.attr("transform", "translate(0 ,10)")
 	}
	function clearLegendHeadingBarcharts(){
		//this function will clear the heading, legend and the bar charts added by the transport and time to travel functions. 
		d3.selectAll("#timetotravel").remove();
		d3.selectAll("#transportmap").remove();
        d3.select("#multi-wrapper").selectAll("svg").remove();
		
	}
	
	//Divi changes end here 
					
		</script>
	</body>


	</html>

